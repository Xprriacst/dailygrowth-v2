<!DOCTYPE html>
<html>
<head>
    <title>Test Final - Notification 9h53</title>
</head>
<body>
    <h1>üéØ Test Final - Notification √† l'heure</h1>
    
    <button onclick="testNotificationSystem()">üöÄ Test Complet</button>
    <div id="result"></div>

    <script>
        async function testNotificationSystem() {
            const result = document.getElementById('result');
            result.innerHTML = '<p>‚è≥ Test du syst√®me complet...</p>';
            
            try {
                // Test the cron function with current time logic
                const response = await fetch('https://hekdcsulxrukfturuone.supabase.co/functions/v1/cron-daily-notifications', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imhla2Rjc3VseHJ1a2Z0dXJ1b25lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwNTEyMDQsImV4cCI6MjA2OTYyNzIwNH0.xLlrQwSL44QpYdeMPF1PIt3DZoaZ6Cjs2OIvEX58CnY'
                    },
                    body: JSON.stringify({
                        trigger: 'test-final',
                        timestamp: new Date().toISOString()
                    })
                });
                
                const data = await response.json();
                
                result.innerHTML = `
                    <h3>‚úÖ R√©sultat Final:</h3>
                    <pre style="background: #f0f0f0; padding: 15px; border-radius: 5px;">${JSON.stringify(data, null, 2)}</pre>
                `;
                
                if (data.result && data.result.notifications_sent > 0) {
                    result.innerHTML += `
                        <div style="background: #d4edda; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            <h4 style="color: #155724;">üéâ SUCC√àS !</h4>
                            <p><strong>${data.result.notifications_sent}</strong> notification(s) envoy√©e(s)</p>
                            <p>Tu devrais recevoir une notification sur ton iPhone maintenant !</p>
                        </div>
                    `;
                } else {
                    result.innerHTML += `
                        <div style="background: #f8d7da; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            <h4 style="color: #721c24;">‚ö†Ô∏è Probl√®me</h4>
                            <p>Utilisateurs trouv√©s: ${data.result?.total_users_checked || 0}</p>
                            <p>Notifications envoy√©es: ${data.result?.notifications_sent || 0}</p>
                            <p><strong>V√©rifie:</strong></p>
                            <ul>
                                <li>reminder_notifications_enabled = true</li>
                                <li>fcm_token renseign√© dans la base</li>
                                <li>Permissions accord√©es sur iPhone</li>
                            </ul>
                        </div>
                    `;
                }
                
            } catch (error) {
                result.innerHTML = `<p style="color: red;">‚ùå Erreur: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>